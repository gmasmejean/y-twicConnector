/**
 * yjs - A framework for real-time p2p shared editing on any data
 * @version v12.3.3
 * @link http://y-js.org
 * @license MIT
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,o.yTwic=e()}}(function(){return function e(o,t,r){function n(s,u){if(!t[s]){if(!o[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(i)return i(s,!0);var _=new Error("Cannot find module '"+s+"'");throw _.code="MODULE_NOT_FOUND",_}var f=t[s]={exports:{}};o[s][0].call(f.exports,function(e){var t=o[s][1][e];return n(t||e)},f,f.exports,e,o,t,r)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,o,t){"use strict";function r(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function n(e,o){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?e:o}function i(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}function s(e){var o=function(e){function o(e,t){if(r(this,o),void 0===t)throw new Error("Options must not be undefined!");if(!t.room)throw new Error("You must define a room name!");if(!t.socket)throw new Error("You have to set a websocket object");if(!t.user_id)throw new Error("You have to define user id");t.role="slave";var i=n(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e,t));console.log("yTwic - CONSTRUCTOR",e,t,i);var s=t.socket,u=i;return u._socket=t.socket,u._room=t.room,u._user_id=t.user_id,u.setUserId(t.user_id),i._onNewPeer=function(e){console.log("NEWPEER",e,u._user_id),e.user_id!=u._user_id&&(s.emit("yjs_roommember",{room:u._room,id:u._user_id,to:e.user_id}),u.userJoined(e.user_id,"master"))},i._onOldPeer=function(e){console.log("OLDPEER",e,u._user_id),u.userLeft(e.user_id)},i._onPrevPeer=function(e){console.log("PREVPEER",e,u._user_id),u.userJoined(e.user_id,"master")},i._onMessage=function(e){console.log("YMESSAGE",e,u._user_id),e.user_id!=u._user_id&&u.receiveMessage(e.user_id,e.message)},i._onAuth=function(){u.reconnect()},s.on("yjs_"+t.room+"_newpeer",i._onNewPeer),s.on("yjs_"+t.room+"_oldpeer",i._onOldPeer),s.on("yjs_"+t.room+"_prevpeer",i._onPrevPeer),s.on("yjs_"+t.room+"_message",i._onMessage),s.on("authenticated",i._onAuth),s.emit("yjs_joinroom",{room:t.room,id:t.user_id}),s.on("disconnect",function(){u.disconnect()}),i}return i(o,e),u(o,[{key:"destroy",value:function(){this._socket.off("yjs_"+this._room+"_newpeer",this._onNewPeer),this._socket.off("yjs_"+this._room+"_oldpeer",this._onOldPeer),this._socket.off("yjs_"+this._room+"_prevpeer",this._onPrevPeer),this._socket.off("yjs_"+this._room+"_message",this._onMessage),this._socket.off("authenticated",this._onAuth),this.disconnect()}},{key:"disconnect",value:function(){console.log("yTwic - DISCONNECT",arguments,this),this._socket.emit("yjs_leaveroom",{room:this._room,id:this._user_id}),c(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"disconnect",this).call(this)}},{key:"reconnect",value:function(){console.log("yTwic - RECONNECT",arguments,this),this._socket.emit("yjs_joinroom",{room:this._room,id:this._user_id}),c(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"reconnect",this).call(this)}},{key:"send",value:function(e,o){console.log("yTwic - SEND",e,o,this),this._socket.emit("yjs_message",{room:this._room,to:e,message:o,author:this._user_id})}},{key:"broadcast",value:function(e){console.log("yTwic - BROADCAST",e,this),this._socket.emit("yjs_message",{room:this._room,message:e,author:this._user_id})}},{key:"isDisconnected",value:function(){return this._socket.disconnected}}]),o}(e.AbstractConnector);e.extend("twic",o)}var u=function(){function e(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(o,t,r){return t&&e(o.prototype,t),r&&e(o,r),o}}(),c=function e(o,t,r){null===o&&(o=Function.prototype);var n=Object.getOwnPropertyDescriptor(o,t);if(void 0===n){var i=Object.getPrototypeOf(o);return null===i?void 0:e(i,t,r)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(r)};o.exports=s,"undefined"!=typeof Y&&s(Y)},{}]},{},[1])(1)});
//# sourceMappingURL=y-twic.js.map
