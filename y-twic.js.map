{"version":3,"sources":["../yjs/node_modules/browser-pack/_prelude.js","src/twicConnector.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","yTwic","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","extend","Y","twicConnector","_Y$AbstractConnector","y","options","_classCallCheck","undefined","room","socket","user_id","role","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","console","log","_socket","_room","_user_id","setUserId","_onNewPeer","data","emit","id","to","userJoined","_onOldPeer","userLeft","_onPrevPeer","_onMessage","receiveMessage","message","_onAuth","reconnect","on","disconnect","_inherits","_createClass","key","value","off","arguments","_get","prototype","uid","author","disconnected","AbstractConnector"],"mappings":"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","file":"y-twic.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict'\n\nfunction extend (Y) {\n    class twicConnector extends Y.AbstractConnector {\n        constructor (y, options) {\n            if (options === undefined) {\n                throw new Error('Options must not be undefined!');\n            }\n            else if ( !options.room ) {\n                throw new Error('You must define a room name!');\n            }\n            else if( !options.socket ){\n                throw new Error('You have to set a websocket object');\n            }\n            else if( !options.user_id ){\n                throw new Error('You have to define user id');\n            }\n\n            options.role = 'slave';\n            super(y, options);\n\n            console.log('yTwic - CONSTRUCTOR', y, options, this);\n\n            var socket = options.socket,\n                self = this;\n\n            self._socket = options.socket;\n            self._room = options.room;\n            self._user_id = options.user_id;\n\n            self.setUserId(options.user_id);\n\n            // DEFINE EVENTS HANDLERS\n            // WHEN A PEER JOIN THE ROOM.\n            this._onNewPeer = function( data ){\n                console.log('NEWPEER', data , self._user_id );\n                if( data.user_id != self._user_id ){\n                    socket.emit('yjs_roommember', {room:self._room, id:self._user_id, to: data.user_id } );\n                    self.userJoined( data.user_id, 'master');\n                }\n            };\n            // WHEN A PEER LEAVE THE ROOM.\n            this._onOldPeer = function( data ){\n                console.log('OLDPEER', data, self._user_id );\n                self.userLeft(data.user_id);\n            };\n            // AFTER WE JOINED THE ROOM, EACH PEER TELL US THEY'RE IN...\n            this._onPrevPeer = function(data){\n                console.log('PREVPEER', data , self._user_id );\n                self.userJoined( data.user_id, 'master');\n            };\n            // ON MESSAGE\n            this._onMessage = function( data ){\n                console.log('YMESSAGE', data, self._user_id );\n                if( data.user_id != self._user_id ){\n                    self.receiveMessage( data.user_id, data.message );\n                }\n            };\n            // WHEN SOCKET RECONNECT & IS AUTHENTICATED\n            this._onAuth = function(){\n                self.reconnect();\n            };\n\n            // BIND EVENTS\n            socket.on('yjs_'+options.room+'_newpeer', this._onNewPeer);\n            socket.on('yjs_'+options.room+'_oldpeer', this._onOldPeer);\n            socket.on('yjs_'+options.room+'_prevpeer', this._onPrevPeer);\n            socket.on('yjs_'+options.room+'_message', this._onMessage);\n            socket.on('authenticated', this._onAuth);\n\n            // JOIN YJS ROOM\n            socket.emit( 'yjs_joinroom', {room:options.room, id:options.user_id} );\n\n            // WHEN SOCKET IS DISCONNECTED -> DISCONNECT \n            socket.on('disconnect', function(){\n                self.disconnect();\n            });\n        }\n        destroy(){\n            // UNBIND EVENTS\n            this._socket.off('yjs_'+this._room+'_newpeer', this._onNewPeer);\n            this._socket.off('yjs_'+this._room+'_oldpeer', this._onOldPeer);\n            this._socket.off('yjs_'+this._room+'_prevpeer', this._onPrevPeer);\n            this._socket.off('yjs_'+this._room+'_message', this._onMessage);\n            this._socket.off('authenticated', this._onAuth );\n\n            this.disconnect();\n        }\n        disconnect () {\n            console.log('yTwic - DISCONNECT', arguments, this );\n            this._socket.emit('yjs_leaveroom',{room:this._room, id:this._user_id});\n            super.disconnect()\n        }\n        reconnect () {\n            console.log( 'yTwic - RECONNECT', arguments, this);\n            this._socket.emit( 'yjs_joinroom', {room:this._room, id:this._user_id} );\n            super.reconnect()\n        }\n        send (uid, message) {\n            console.log('yTwic - SEND', uid, message, this );\n            this._socket.emit('yjs_message',{room:this._room, to: uid, message: message, author:this._user_id});\n        }\n        broadcast (message) {\n            console.log('yTwic - BROADCAST', message, this );\n            this._socket.emit('yjs_message',{room:this._room, message: message, author:this._user_id});\n        }\n        isDisconnected () {\n            return this._socket.disconnected;\n        }\n    }\n    Y.extend('twic', twicConnector);\n}\n\nmodule.exports = extend;\nif (typeof Y !== 'undefined') {\n    extend(Y);\n}\n"]}